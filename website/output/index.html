<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    
    <!-- CodeRay syntax highlighting CSS -->
    <link rel="stylesheet" href="css/coderay.css" type="text/css" />
    
    <!-- Homepage CSS -->
    <link rel="stylesheet" href="css/site.css" type="text/css" media="screen, projection" />
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Callbacks</title>
    <meta name="author" content="" />
    <script src="javascripts/rounded_corners_lite.inc.js" type="text/javascript"></script>
    <style>
      
    </style>
    <script type="text/javascript">
        window.onload = function() {
            settings = {
                tl: { radius: 10 },
                tr: { radius: 10 },
                bl: { radius: 10 },
                br: { radius: 10 },
                antiAlias: true,
                autoPad: true,
                validTags: ["div"]
            }
            var versionBox = new curvyCorners(settings, document.getElementById("version"));
            versionBox.applyCornersToAll();
        }
    </script>
  </head>
  <body>
    <div id="main">
      
      <h1>&#x2192; Callbacks</h1>
      <div id="version" class="clickable" >
        <p>Get Version</p>
        <a href="http://rubyforge.org/projects/callbacks" class="numbers">
          0.0.1
        </a>
      </div>
      
      
<h2>Callbacks?</h2>
<p>You know! That nifty feature that's also in Rails. First let me explain what callbacks are: callbacks are pieces of code
  that get called whenever a predefined action occurs.
</p>

<p>A simple example: when a song in your favourite music player
  has ended a callback could be issued which will update the UI, jump to the next song and update your 
  <a href="http://last.fm">last.fm</a> account.
</p>

<p>
  This is of course a very simple example (I don't know how music players work). But it could well work just like I described.
</p>

<h2>Usage</h2>
<p>But if you found this little gem, you of course now what callbacks are. So lets jump to the nice stuff: code examples!</p>

<div class="CodeRay"><pre><span class="no"> 1</span> require <span class="s"><span class="dl">'</span><span class="k">callbacks</span><span class="dl">'</span></span>
<span class="no"> 2</span> 
<span class="no"> 3</span> <span class="co">Object</span>.send(<span class="sy">:include</span>, <span class="co">Callbacks</span>)
<span class="no"> 4</span> <span class="co">Object</span>.add_callback_methods <span class="sy">:inspect</span>
<span class="no"> 5</span> <span class="co">Object</span>.before_inspect <span class="r">do</span>
<span class="no"> 6</span>   print <span class="s"><span class="dl">&quot;</span><span class="k">Going to inspect </span><span class="il"><span class="idl">#{</span><span class="pc">self</span>.class<span class="idl">}</span></span><span class="ch">\n</span><span class="dl">&quot;</span></span>
<span class="no"> 7</span> <span class="r">end</span>
<span class="no"> 8</span> 
<span class="no"> 9</span> o = <span class="co">Object</span>.new
<span class="no"><strong>10</strong></span> o.inspect <span class="c">#will print &quot;Going to inspect Object&quot;</span>
</pre></div>

<p>Another (better example)</p>
<div class="CodeRay"><pre><span class="no"> 1</span> <span class="r">class</span> <span class="cl">MusicPlayer</span>
<span class="no"> 2</span> 
<span class="no"> 3</span>   <span class="r">def</span> <span class="fu">play</span>
<span class="no"> 4</span>     p <span class="s"><span class="dl">'</span><span class="k">begining to play song</span><span class="dl">'</span></span>
<span class="no"> 5</span>     sleep <span class="i">5</span>
<span class="no"> 6</span>     <span class="pc">self</span>.end_of_song
<span class="no"> 7</span>   <span class="r">end</span>
<span class="no"> 8</span> 
<span class="no"> 9</span>   <span class="r">def</span> <span class="fu">end_of_song</span>
<span class="no"><strong>10</strong></span>     p <span class="s"><span class="dl">'</span><span class="k">End reached. Quiting player</span><span class="dl">'</span></span>
<span class="no">11</span>   <span class="r">end</span>
<span class="no">12</span> 
<span class="no">13</span>   include <span class="co">Callbacks</span>
<span class="no">14</span>   add_callback_methods <span class="sy">:end_of_song</span>
<span class="no">15</span> 
<span class="no">16</span>   before_end_of_song <span class="r">do</span>
<span class="no">17</span>     p <span class="s"><span class="dl">&quot;</span><span class="k">I'm almost gonna die. I feel the end coming.</span><span class="dl">&quot;</span></span>
<span class="no">18</span>   <span class="r">end</span>
<span class="no">19</span> 
<span class="no"><strong>20</strong></span>   after_end_of_song <span class="r">do</span>
<span class="no">21</span>     p <span class="s"><span class="dl">'</span><span class="k">Arghhh...</span><span class="dl">'</span></span>
<span class="no">22</span>   <span class="r">end</span>
<span class="no">23</span> <span class="r">end</span>
<span class="no">24</span> 
<span class="no">25</span> mp = <span class="co">MusicPlayer</span>.new
<span class="no">26</span> mp.play
</pre></div>

<h2>How is this magic achieved?</h2>

<p>
  First of all: when you include the Callbacks module in a class,several class methods get added. For example:
  <ul>
    <li>add_callback_methods</li>
    <li>callback_methods</li>
    <li>callback_actions</li>
    <li>et cetera</li>
  </ul>
</p>

<p>
  An instance variable called <code>@callback_methods</code> and one called <code>@callback_actions</code> are now available in the class where you included Callbacks.
  When you add a callback with <code>add_callback_methods()</code>, @callback_methods gets filled.
  A couple of more methods are generated:
  <ul>
    <li>before_#{method}</li>
    <li>after_#{method}</li>
    <li>#{method}_without_callbacks</li>
  </ul>
</p>

<p>Now we can add actions to the class with the usage of (for example) <code>after_boot</code> & <code>before_boot</code></p>
<p>With these two methods the instance variable @callback_actions is filled.</p>
<p>Callbacks are stored as a callback object in this variable. The object saves the original input containing one of these:</p>
<ul>
  <li>String</li>
  <li>Proc</li>
  <li>Block</li>
  <li>Symbol</li>
</ul>
<p>The very first time a callback is called, a proc (or block. Depending on the need to access "self" of the class used for the callbacks) is generated and stored in the callback object.</p>

<h2>More documentation</h2>
<p>More documentation can be found <a href="http://callbacks.rubyforge.org/docs/" title="more documenation">here</a>.

<h2>Future</h2>
<p>In version 0.2 I want to add stuff so you can add callbacks to this one instance of a class and not ALL instances. If you have interesting suggestions: mail me!</p>
<p>And I think about adding some method aliases like <code>add_hook</code> or <code>add_handler</code> and stuff like that.</p>
      
      <p class="coda">
        Theme extended from <a href="http://rb2js.rubyforge.org/">Paul Battley</a><br />
        This website was created with <a href="http://webby.rubyforge.org">Webby</a>
      </p>
    </div>
    
  </body>
</html>
